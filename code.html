<!DOCTYPE html>
<!--**************************************-->
<!--*    Generated from PreTeXt source   *-->
<!--*    on 2019-11-21T15:45:43-05:00    *-->
<!--*                                    *-->
<!--*      https://pretextbook.org       *-->
<!--*                                    *-->
<!--**************************************-->
<html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Code repository</title>
<meta name="Keywords" content="Authored in PreTeXt">
<meta name="viewport" content="width=device-width,  initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
<script src="https://sagecell.sagemath.org/embedded_sagecell.js"></script><script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [['\\(','\\)']]
    },
    asciimath2jax: {
        ignoreClass: ".*",
        processClass: "has_am"
    },
    jax: ["input/AsciiMath"],
    extensions: ["asciimath2jax.js"],
    TeX: {
        extensions: ["extpfeil.js", "autobold.js", "https://pretextbook.org/js/lib/mathjaxknowl.js", ],
        // scrolling to fragment identifiers is controlled by other Javascript
        positionToHash: false,
        equationNumbers: { autoNumber: "none", useLabelIds: true, },
        TagSide: "right",
        TagIndent: ".8em",
    },
    // HTML-CSS output Jax to be dropped for MathJax 3.0
    "HTML-CSS": {
        scale: 88,
        mtextFontInherit: true,
    },
    CommonHTML: {
        scale: 88,
        mtextFontInherit: true,
    },
});
</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_CHTML-full"></script><script>$(function () {
    // Make *any* div with class 'sagecell-sage' an executable Sage cell
    // Their results will be linked, only within language type
    sagecell.makeSagecell({inputLocation: 'div.sagecell-sage',
                           linked: true,
                           languages: ['sage'],
                           evalButtonText: 'Evaluate (Sage)'});
});
</script><script>$(function () {
    // Make *any* div with class 'sagecell-python' an executable Sage cell
    // Their results will be linked, only within language type
    sagecell.makeSagecell({inputLocation: 'div.sagecell-python',
                           linked: true,
                           languages: ['python'],
                           evalButtonText: 'Evaluate (Python)'});
});
</script><script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script><script src="https://pretextbook.org/js/lib/jquery.min.js"></script><script src="https://pretextbook.org/js/lib/jquery.sticky.js"></script><script src="https://pretextbook.org/js/lib/jquery.espy.min.js"></script><script src="https://pretextbook.org/js/0.12/pretext.js"></script><script src="https://pretextbook.org/js/0.12/pretext_add_on.js"></script><script src="https://pretextbook.org/js/lib/knowl.js"></script><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,400italic,600,600italic" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Inconsolata:400,700&amp;subset=latin,latin-ext" rel="stylesheet" type="text/css">
<link href="https://pretextbook.org/css/0.2/pretext.css" rel="stylesheet" type="text/css">
<link href="https://pretextbook.org/css/0.2/pretext_add_on.css" rel="stylesheet" type="text/css">
<link href="https://pretextbook.org/css/0.2/toc.css" rel="stylesheet" type="text/css">
<link href="https://pretextbook.org/css/0.2/colors_default.css" rel="stylesheet" type="text/css">
<link href="https://pretextbook.org/css/0.2/setcolors.css" rel="stylesheet" type="text/css">
<link href="https://pretextbook.org/css/0.2/features.css" rel="stylesheet" type="text/css">
<script>var logged_in = false;
var role = 'student';
var guest_access = true;
var login_required = false;
var js_version = 0.12;
</script>
</head>
<body class="mathbook-book has-toc has-sidebar-left">
<a class="assistive" href="#content">Skip to main content</a><div class="hidden-content" style="display:none">\(\DeclareMathOperator{\RE}{Re}
\DeclareMathOperator{\IM}{Im}
\DeclareMathOperator{\ess}{ess}
\DeclareMathOperator{\intr}{int}
\DeclareMathOperator{\dist}{dist}
\DeclareMathOperator{\dom}{dom}
\DeclareMathOperator{\diag}{diag}
\DeclareMathOperator\re{\mathrm {Re~}}
\DeclareMathOperator\im{\mathrm {Im~}}
\newcommand\dd{\mathrm d}
\newcommand{\eps}{\varepsilon}
\newcommand{\To}{\longrightarrow}
\newcommand{\hilbert}{\mathcal{H}}
\newcommand{\s}{\mathcal{S}_2}
\newcommand{\A}{\mathcal{A}}
\newcommand\h{\mathcal{H}}
\newcommand{\J}{\mathcal{J}}
\newcommand{\M}{\mathcal{M}}
\newcommand{\F}{\mathbb{F}}
\newcommand{\N}{\mathcal{N}}
\newcommand{\T}{\mathbb{T}}
\newcommand{\W}{\mathcal{W}}
\newcommand{\X}{\mathcal{X}}
\newcommand{\D}{\mathbb{D}}
\newcommand{\C}{\mathbb{C}}
\newcommand{\BOP}{\mathbf{B}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\BH}{\mathbf{B}(\mathcal{H})}
\newcommand{\KH}{\mathcal{K}(\mathcal{H})}
\newcommand{\pick}{\mathcal{P}_2}
\newcommand{\schur}{\mathcal{S}_2}
\newcommand{\R}{\mathbb{R}}
\newcommand{\Complex}{\mathbb{C}}
\newcommand{\Field}{\mathbb{F}}
\newcommand{\RPlus}{\Real^{+}}
\newcommand{\Polar}{\mathcal{P}_{\s}}
\newcommand{\Poly}{\mathcal{P}(E)}
\newcommand{\EssD}{\mathcal{D}}
\newcommand{\Lop}{\mathcal{L}}
\newcommand{\cc}[1]{\overline{#1}}
\newcommand{\abs}[1]{\left\vert#1\right\vert}
\newcommand{\set}[1]{\left\{#1\right\}}
\newcommand{\seq}[1]{\left\lt#1\right&gt;}
\newcommand{\norm}[1]{\left\Vert#1\right\Vert}
\newcommand{\essnorm}[1]{\norm{#1}_{\ess}}
\newcommand{\tr}{\operatorname{tr}}
\newcommand{\ran}[1]{\operatorname{ran}#1}
\newcommand{\nt}{\stackrel{\mathrm {nt}}{\to}}
\newcommand{\pnt}{\xrightarrow{pnt}}
\newcommand{\ip}[2]{\left\langle #1, #2 \right\rangle}
\newcommand{\ad}{^\ast}
\newcommand{\inv}{^{-1}}
\newcommand{\adinv}{^{\ast -1}}
\newcommand{\invad}{^{-1 \ast}}
\newcommand\Pick{\mathcal P}
\newcommand\Ha{\mathbb{H}}
\newcommand{\HH}{\Ha\times\Ha}
\newcommand\Htau{\mathbb{H}(\tau)}
\newcommand{\vp}{\varphi}
\newcommand{\ph}{\varphi}
\newcommand\al{\alpha}
\newcommand\ga{\gamma}
\newcommand\de{\delta}
\newcommand\ep{\varepsilon}
\newcommand\la{\lambda}
\newcommand\up{\upsilon}
\newcommand\si{\sigma}
\newcommand\beq{\begin{equation}}
\newcommand\ds{\displaystyle}
\newcommand\eeq{\end{equation}}
\newcommand\df{\stackrel{\rm def}{=}}
\newcommand\ii{\mathrm i}
\newcommand{\vectwo}[2]
{
   \begin{pmatrix} #1 \\ #2 \end{pmatrix}
}
\newcommand{\vecthree}[3]
{
   \begin{pmatrix} #1 \\ #2 \\ #3 \end{pmatrix}
}
\newcommand\blue{\color{blue}}
\newcommand\black{\color{black}}
\newcommand\red{\color{red}}
\newcommand\nn{\nonumber}
\newcommand\bbm{\begin{bmatrix}}
\newcommand\ebm{\end{bmatrix}}
\newcommand\bpm{\begin{pmatrix}}
\newcommand\epm{\end{pmatrix}}
\numberwithin{equation}{section}
\newcommand\nin{\noindent}
\newcommand{\nCr}[2]{\,_{#1}C_{#2}} 
\newcommand{\lt}{&lt;}
\newcommand{\gt}{&gt;}
\newcommand{\amp}{&amp;}
\)</div>
<header id="masthead" class="smallbuttons"><div class="banner"><div class="container">
<a id="logo-link" href=""></a><div class="title-container">
<h1 class="heading"><a href="cryptography.html"><span class="title">Mathematical Cryptography</span></a></h1>
<p class="byline">Ryan Tully-Doyle</p>
</div>
</div></div>
<nav id="primary-navbar" class="navbar"><div class="container">
<div class="navbar-top-buttons">
<button class="sidebar-left-toggle-button button active" aria-label="Show or hide table of contents sidebar">Contents</button><div class="tree-nav toolbar toolbar-divisor-3"><span class="threebuttons"><a id="previousbutton" class="previous-button toolbar-item button" href="backmatter-1.html" title="Previous">Prev</a><a id="upbutton" class="up-button button toolbar-item" href="backmatter-1.html" title="Up">Up</a><a id="nextbutton" class="next-button button toolbar-item" href="chapter-7.html" title="Next">Next</a></span></div>
</div>
<div class="navbar-bottom-buttons toolbar toolbar-divisor-4">
<button class="sidebar-left-toggle-button button toolbar-item active">Contents</button><a class="previous-button toolbar-item button" href="backmatter-1.html" title="Previous">Prev</a><a class="up-button button toolbar-item" href="backmatter-1.html" title="Up">Up</a><a class="next-button button toolbar-item" href="chapter-7.html" title="Next">Next</a>
</div>
</div></nav></header><div class="page">
<div id="sidebar-left" class="sidebar" role="navigation"><div class="sidebar-content">
<nav id="toc"><ul>
<li class="link"><a href="frontmatter-1.html" data-scroll="frontmatter-1"><span class="title">Front Matter</span></a></li>
<li class="link">
<a href="chapter-intro.html" data-scroll="chapter-intro"><span class="codenumber">1</span> <span class="title">Preliminaries</span></a><ul>
<li><a href="foreward.html" data-scroll="foreward">The course</a></li>
<li><a href="motivation.html" data-scroll="motivation">Why “mathematical” cryptography?</a></li>
<li><a href="shift.html" data-scroll="shift">A simple example: the shift cipher</a></li>
</ul>
</li>
<li class="link">
<a href="chapter-numbertheory.html" data-scroll="chapter-numbertheory"><span class="codenumber">2</span> <span class="title">Number theory</span></a><ul>
<li><a href="divisibility.html" data-scroll="divisibility">Integers and divisibility</a></li>
<li><a href="section-euclidean.html" data-scroll="section-euclidean">Common divisors and the Euclidean algorithm</a></li>
<li><a href="section-modular.html" data-scroll="section-modular">Modular arithmetic and the ring of integers modulo \(n\)</a></li>
<li><a href="section-fastpower.html" data-scroll="section-fastpower">The fast powering algorithm</a></li>
<li><a href="section-finite-fields.html" data-scroll="section-finite-fields">Finite fields</a></li>
<li><a href="section-fermat.html" data-scroll="section-fermat">Fermat's little theorem and computing inverses</a></li>
<li><a href="section-ch2-conclusion.html" data-scroll="section-ch2-conclusion">Conclusion</a></li>
</ul>
</li>
<li class="link">
<a href="chapter-groups.html" data-scroll="chapter-groups"><span class="codenumber">3</span> <span class="title">Group based methods</span></a><ul>
<li><a href="section-naive.html" data-scroll="section-naive">A naïve cryptosystem and some related questions</a></li>
<li><a href="section-discretelog.html" data-scroll="section-discretelog">Discrete logarithms</a></li>
<li><a href="section-dh.html" data-scroll="section-dh">Diffie-Hellman key exchange</a></li>
<li><a href="section-elgamal.html" data-scroll="section-elgamal">The Elgamal cryptosystem</a></li>
<li><a href="section-groups.html" data-scroll="section-groups">Groups</a></li>
<li><a href="section-attack-dlp.html" data-scroll="section-attack-dlp">Attacking the discrete log problem</a></li>
<li><a href="section-chinese.html" data-scroll="section-chinese">The Chinese Remainder theorem and Pohlig-Hellman*</a></li>
<li><a href="section-homomorphism.html" data-scroll="section-homomorphism">Homomorphisms and the lunchtime attack</a></li>
</ul>
</li>
<li class="link">
<a href="chapter-elliptic-curves.html" data-scroll="chapter-elliptic-curves"><span class="codenumber">4</span> <span class="title">Elliptic curves and applications</span></a><ul>
<li><a href="section-ec-intro.html" data-scroll="section-ec-intro">Introduction to elliptic curves</a></li>
<li><a href="section-elliptic-addition.html" data-scroll="section-elliptic-addition">Elliptic addition on \(E\text{.}\)</a></li>
<li><a href="section-ec-finite-fields.html" data-scroll="section-ec-finite-fields">Elliptic curves over finite fields</a></li>
<li><a href="section-ecdlp.html" data-scroll="section-ecdlp">Discrete logs and the ECDLP</a></li>
<li><a href="section-ec-elgamal.html" data-scroll="section-ec-elgamal">Elliptic curve Diffie-Hellman key exchange and El Gamal</a></li>
</ul>
</li>
<li class="link">
<a href="chapter-digital-signatures.html" data-scroll="chapter-digital-signatures"><span class="codenumber">5</span> <span class="title">Digital signatures</span></a><ul>
<li><a href="section-dsa-intro.html" data-scroll="section-dsa-intro">Introduction to digital signatures</a></li>
<li><a href="section-elgamal-ds.html" data-scroll="section-elgamal-ds">Elgamal digital signatures</a></li>
<li><a href="section-subgroups.html" data-scroll="section-subgroups">Subgroups and cyclic subgroups</a></li>
<li><a href="section-dsa-ecdsa.html" data-scroll="section-dsa-ecdsa">DSA and Elliptic Curve DSA</a></li>
<li><a href="section-bitcoin.html" data-scroll="section-bitcoin">Bitcoin - an application of ECDSA*</a></li>
</ul>
</li>
<li class="link">
<a href="chapter-probability.html" data-scroll="chapter-probability"><span class="codenumber">6</span> <span class="title">Probability and non-deterministic methods</span></a><ul>
<li><a href="section-counting.html" data-scroll="section-counting">Counting*</a></li>
<li><a href="section-perm-comb.html" data-scroll="section-perm-comb">Permutations and combinations*</a></li>
<li><a href="section-prime-testing.html" data-scroll="section-prime-testing">Primality testing</a></li>
<li><a href="section-pollard-concrete.html" data-scroll="section-pollard-concrete">Pollard's \(\rho\) method</a></li>
</ul>
</li>
<li class="link"><a href="backmatter-1.html" data-scroll="backmatter-1"><span class="title">Back Matter</span></a></li>
<li class="link active"><a href="code.html" data-scroll="code"><span class="codenumber">A</span> <span class="title">Code repository</span></a></li>
<li class="link">
<a href="chapter-7.html" data-scroll="chapter-7"><span class="codenumber">7</span> <span class="title">Exercises</span></a><ul>
<li><a href="exercises-21.html" data-scroll="exercises-21">Set 1</a></li>
<li><a href="exercises-22.html" data-scroll="exercises-22">Set 2</a></li>
<li><a href="exercises-23.html" data-scroll="exercises-23">Set 3</a></li>
<li><a href="exercises-24.html" data-scroll="exercises-24">Set 4</a></li>
</ul>
</li>
</ul></nav><div class="extras"><nav><a class="mathbook-link" href="https://pretextbook.org">Authored in PreTeXt</a><a href="https://www.mathjax.org"><img title="Powered by MathJax" src="https://www.mathjax.org/badge/badge.gif" alt="Powered by MathJax"></a></nav></div>
</div></div>
<main class="main"><div id="content" class="pretext-content"><section class="appendix" id="code"><h2 class="heading hide-type">
<span class="type">Appendix</span> <span class="codenumber">A</span> <span class="title">Code repository</span>
</h2>
<a href="code.html" class="permalink">¶</a><figure class="figure-like" id="listing-1"><pre class="plainprint">import random as rand
from math import gcd, log

#this function factors all of the available powers
#of 2 out of n-1
def twofactor(n):
  m = n -1
  i, q, r = 0,0,0
  while True:
    q, r = divmod(m, 2)
    if r == 1:
      break
    m = q
    i = i + 1
  return m,i

#this function performs one round of the Miller-Rabin test
#for compositeness. The witnesses are randomly generated.
def millerrabin(n):
  if n%2 == 0:
    return True
  else:
    a = rand.randint(1, n-1)
    if gcd(a,n) != 1:
      return True

    q,k = twofactor(n)
    i = 0
    a = pow(a,q,n)
    if a ==1%n:
      return False

    while i &lt; k:
      if a == -1 %n:
        return False
      a = a**2%n
      i = i + 1
    else:
      return True


#main function to run the Miller-Rabin test N times --
#uses a float to calculate probability of primaility given N loops
def main():
  n = int(input("Input an integer to test:"))
  N = int(input("Enter number of witnesses to test:"))
  for i in range(1,N):
    if millerrabin(n) == True:
      print("Composite")
      break
    else:
      prob = 1 - log(n)/4**N
      print("Prime likelihood is approx %f" %prob)
      break
</pre>
<figcaption><span class="type">Listing</span> <span class="codenumber">A.0.1.</span> Miller-Rabin</figcaption></figure><figure class="figure-like" id="listing-2"><pre class="plainprint">from math import floor

def mixer(g,h,x,p, a, b):
    x = x%p
    if x &lt; floor(p/3):
        return g*x%p, a+1%(p-1), b%(p-1)
    elif x &lt; floor(2*p/3):
        return x**2%p, 2*a%(p-1), 2*b%(p-1)
    else:
        return x*h, a%(p-1), b+1%(p-1)

def xgcd(a, b):
    """return (g, x, y) such that a*x + b*y = g = gcd(a, b)"""
    x0, x1, y0, y1 = 0, 1, 1, 0
    while a != 0:
        q, b, a = b // a, a, b % a
        y0, y1 = y1, y0 - q * y1
        x0, x1 = x1, x0 - q * x1
    return b, x0, y0

def collision():
    x = 1
    y = 1
    g = 19
    h = 24717
    p = 48611
    ax = 0
    bx = 0
    ay = 0
    by = 0
    while True:
        x, ax, bx = mixer(g,h,x,p,ax,bx)
        y, ay, by = mixer(g,h,y,p,ay,by)
        y, ay, by = mixer(g,h,y,p,ay,by)
        if x == y:
            break
    print(x,y, ax, bx, ay, by)
    u = (ax - ay)%(p-1)
    v = (by - bx)%(p-1)
    print(u,v)
    d, s, t = xgcd(v,p-1)
    print(d, s, t)
    s = abs(s)
    print(s)
    w = s*u %(p-1)
    print(w)
    powers = [int(w/d + k*(p-1)/d) for k in range(0,d-1)]
    print(powers)
    for i in powers:
        if pow(g,i,p) == h%p:
            log = i
            break
    print(i)
    print(pow(g,log,p))
</pre>
<figcaption><span class="type">Listing</span> <span class="codenumber">A.0.2.</span> Pollard rho in \(\F_p\ad\)</figcaption></figure><figure class="figure-like" id="listing-3"><pre class="plainprint">def modinv(x,p):
    return pow(x,p-2,p)

def elliptic_add(P, Q, A, p):
    if P == (0,0):
        return Q
    elif Q == (0,0):
        return P
    else:
        xP, yP = P[0], P[1]
        xQ, yQ = Q[0], Q[1]
    if xP == xQ and yP == (-yQ)%p:
        return (0,0)
    else:
        if xP == xQ and yP == yQ:
            m = ((3*xP**2 + A) * pow(2*yP, p-2, p) )%p
        else:
            m = ((yQ - yP)*pow(xQ - xP, p-2, p)) %p
        xR = (m**2 - xP - xQ) %p
        yR = (m*(xP - xR) - yP) %p
        return (xR, yR)

from math import floor
def double_add(P, n, A, p):
    Q = P
    R = (0,0)
    while n &gt; 0:
        if 1 == n %2:
            R = elliptic_add(R, Q, A, p)
        Q = elliptic_add(Q, Q, A, p)
        n = floor(n/2)
    return R

def elliptic_point_order(P, A, p):
    Q = elliptic_add(P,P, A, p)
    count = 1
    while Q != P:
        Q = elliptic_add(Q, P, A, p)
        count = count + 1
    return count

def elliptic_dsa_keygen(G, s, q, A, p):
    s = s % (q - 1)
    V = double_add(G, s, A, p)
    return V

from random import randint

def elliptic_dsa_sign(d, s, G, q, A, p):
    d = d % q
    e = randint(1,q-1)
    einv = pow(e, q-2, q)
    rand_point = double_add(G, e, A, p)
    s1 = rand_point[0] %q
    s2 = ((d + s*s1)*einv) %q
    return (s1,s2)

def elliptic_dsa_verify(d, V, sig, G, q, A, p):
    s1, s2 = sig[0], sig[1]
    v1 = (d*modinv(s2,q))%q
    v2 = (s1*modinv(s2,q))%q
    print(v1, v2)
    check1 = double_add(G, v1, A, p)
    print(check1)
    check2 = double_add(V, v2, A, p)
    print(check2)
    check = elliptic_add(check1, check2, A, p)
    print(s1)
    print(check[0] %q)
</pre>
<figcaption><span class="type">Listing</span> <span class="codenumber">A.0.3.</span> A whole mess of uncommented elliptic functions</figcaption></figure><p id="p-218">The following code is a (currently) uncommented illustration of the basic techniques used in python based linear algebra. The numpy package provides a native data structure, <code class="code-inline tex2jax_ignore">array</code> that can be acted on linear algebraically.</p>
<div class="sagecell-python" id="sage-12"><script type="text/x-sage">import numpy as np

v1 = [137,312]
v2 = [215,-187]

V = np.array([v1, v2])
Vinv = np.linalg.inv(V)

w = np.array([53172,81743])

t = np.dot(w, Vinv)
print(t)

a = np.rint(t)
print(a)

v = np.dot(a,V)
print(v)

dist = np.linalg.norm(v - w)
print(dist)

H = abs(np.linalg.det(V)/(np.linalg.norm(v1)*np.linalg.norm(v2)))
print(np.sqrt(H))

U = np.eye(2)

for  x in range(10):
	I = np.eye(2)
	i = np.random.randint(0,2)
	j = np.random.randint(0,2)
	if i == j:
		I[0,1] = np.random.randint(-10,11)
	else:
		I[i,j] = np.random.randint(-10,11)
	U = np.dot(U, I)

print("determinant of U is %.2f" %np.linalg.det(U))

W = np.dot(U, V)
print(W)
print(np.linalg.det(W))
print(np.linalg.det(V))

badH = abs(np.linalg.det(W)/(np.linalg.norm(W[0])*np.linalg.norm(W[1])))
print(np.sqrt(badH))

badt = np.dot(w, np.linalg.inv(W))
bada = np.rint(badt)
badv = np.dot(bada, W)
baddist = np.linalg.norm(badv - w)
print(baddist)
</script></div></section></div></main>
</div>
<div class="login-link"><span id="loginlogout" class="login">login</span></div>
<script src="https://pretextbook.org/js/0.12/login.js"></script>
</body>
</html>
